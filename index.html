<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seating Info</title>
  <style>
    body {
      font-family: Verdana, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #f9f9f9;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #007BFF;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #0056b3;
    }
    #result {
      margin-top: 20px;
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Enter your name</h2>
    <input type="text" id="nameInput" placeholder="Name">
    <button id="showBtn">Show</button>
    <p id="note">Loading database...</p>
    <div id="result"></div>
  </div>

  <script>
    const input = document.getElementById('nameInput');
    const btn = document.getElementById('showBtn');
    const result = document.getElementById('result');
    const note = document.getElementById('note');

    let people = [];
    let pendingName = null; // ждём уточнения фамилии?

    function loadPeople() {
      fetch('people.json?t=' + Date.now())
        .then(resp => resp.json())
        .then(data => {
          people = data;
          note.textContent = 'Database loaded. Type a name and press Show (or Enter).';
          btn.classList.remove('disabled');
          btn.removeAttribute('aria-disabled');
        })
        .catch(err => {
          console.error(err);
          note.textContent = 'Cannot load people.json.';
          btn.classList.add('disabled');
          btn.setAttribute('aria-disabled', 'true');
        });
    }

    function showInfo() {
      const value = document.getElementById("nameInput").value.trim().toLowerCase();
      result.innerHTML = "";

      if (!value) {
        result.textContent = "Please enter your name.";
        return;
      }

      if (!pendingName) {
        // ищем всех по имени
        const matches = people.filter(p => p.name.toLowerCase() === value);

        if (matches.length === 0) {
          result.textContent = "Name not found.";
        } else if (matches.length === 1) {
          showPerson(matches[0]);
        } else {
          pendingName = value;
          result.innerHTML = `
            <p>Several people with this name found. Please enter your surname:</p>
            <input type="text" id="surnameInput" placeholder="Your surname">
            <button onclick="showInfo()">Confirm</button>
          `;
        }
      } else {
        // уточняем по фамилии
        const surname = document.getElementById("surnameInput").value.trim().toLowerCase();
        const matches = people.filter(p =>
          p.name.toLowerCase() === pendingName && p.surname.toLowerCase() === surname
        );

        if (matches.length === 0) {
          result.textContent = "No match found for this name and surname.";
        } else {
          showPerson(matches[0]);
        }
        pendingName = null;
      }
    }

    function showPerson(person) {
      result.innerHTML = "";

      const [firstLine, secondLine, ...others] = person.text.split("\n");
      result.innerHTML = `<p>${firstLine}</p><p>${secondLine}</p>`;

      const columnsDiv = document.createElement("div");
      columnsDiv.style.display = "grid";
      columnsDiv.style.gridTemplateColumns = "repeat(3, 1fr)";
      columnsDiv.style.gap = "10px";
      columnsDiv.style.marginTop = "10px";

      others.forEach(o => {
        const div = document.createElement("div");
        div.textContent = o;
        columnsDiv.appendChild(div);
      });

      result.appendChild(columnsDiv);
    }

    // обработчики
    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') showInfo(); });
    btn.addEventListener('click', showInfo);

    loadPeople();
  </script>
</body>
</html>
